<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b1020" />
  <title>一鍵開啟相機｜Demo</title>
  <style>
    :root{--bg:#0b1020;--card:#111831;--line:#203055;--fg:#e8eef9}
    html,body{height:100%}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;display:flex;min-height:100dvh;margin:0;background:var(--bg);color:var(--fg)}
    .wrap{margin:auto;max-width:640px;padding:24px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    h1{margin:0 0 6px}
    .hint{opacity:.85;font-size:14px}
    .row{display:grid;gap:12px;margin-top:14px}
    button{width:100%;font-size:18px;padding:14px;border-radius:12px;border:none;cursor:pointer}
    .primary{background:#4f8cff;color:#03122e}
    .muted{background:#17213d;color:#cfe0ff}
    img,video{width:100%;max-height:60dvh;object-fit:contain;border-radius:12px;border:1px solid var(--line);background:#0a1226}
    .badge{display:inline-block;padding:4px 8px;border:1px solid var(--line);border-radius:999px;font-size:12px;background:#0e1730;margin-left:8px}
    .warn{background:#2a0f0f;border-color:#6b1f1f}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>一鍵開啟相機<span id="httpsBadge" class="badge" hidden>HTTPS</span></h1>
      <p class="hint">這個版本適合部署到 <strong>GitHub Pages</strong>（靜態網站 + 預設 HTTPS）。請將檔名命名為 <code>index.html</code> 放在根目錄。</p>

      <!-- 方式 A：最相容（拍照或從相簿擇一） -->
      <div class="row">
        <button id="openCameraBtn" class="primary">拍照 / 選擇照片</button>
        <input id="fileInput" type="file" accept="image/*" capture="environment" style="display:none" />
        <img id="preview" alt="預覽會顯示在這裡" hidden />
      </div>

      <hr style="margin:20px 0;border:0;border-top:1px solid var(--line)" />

      <!-- 方式 B：直接開啟相機串流（需要 HTTPS 與瀏覽器授權） -->
      <div class="row">
        <button id="streamBtn" class="muted">用相機即時取景（可選）</button>
        <video id="video" playsinline autoplay hidden></video>
        <small id="httpsWarn" class="hint warn" style="padding:10px;border-radius:10px" hidden>
          需在 <strong>HTTPS</strong> 網站上才能使用即時取景（GitHub Pages 會自動提供 HTTPS）。
        </small>
      </div>

      <p class="hint" style="margin-top:16px">
        小提醒：
        <br>• 方式 A 最穩定，iOS Safari / Android Chrome 都能叫出相機或相簿。
        <br>• 方式 B 需要 HTTPS 與權限授予，且某些裝置上可能仍顯示權限提示。
      </p>
    </div>
  </div>

  <script>
    // --- 顯示是否在 HTTPS 環境 ---
    (function(){
      const isHttps = location.protocol === 'https:' || location.hostname === 'localhost';
      const httpsBadge = document.getElementById('httpsBadge');
      const httpsWarn = document.getElementById('httpsWarn');
      if (isHttps) {
        httpsBadge.hidden = false;
      } else {
        httpsWarn.hidden = false;
      }
    })();

    // --- 方式 A：透過 <input type="file"> 叫出相機 ---
    const openBtn = document.getElementById('openCameraBtn');
    const fileInput = document.getElementById('fileInput');
    const previewImg = document.getElementById('preview');

    openBtn.addEventListener('click', () => fileInput.click());

    fileInput.addEventListener('change', () => {
      const file = fileInput.files && fileInput.files[0];
      if (!file) return;
      const url = URL.createObjectURL(file);
      previewImg.src = url;
      previewImg.hidden = false;
    });

    // --- 方式 B：navigator.mediaDevices.getUserMedia 開啟鏡頭串流 ---
    const streamBtn = document.getElementById('streamBtn');
    const video = document.getElementById('video');
    let mediaStream;

    streamBtn.addEventListener('click', async () => {
      try {
        mediaStream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: { ideal: 'environment' } },
          audio: false
        });
        video.srcObject = mediaStream;
        video.hidden = false;
      } catch (err) {
        alert('無法開啟相機：' + (err && err.message ? err.message : err));
      }
    });

    // 若離開頁面，關閉串流（省電）
    window.addEventListener('pagehide', () => {
      if (mediaStream) mediaStream.getTracks().forEach(t => t.stop());
    });
  </script>
</body>
</html>
